<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString — Tom Dalling</title>
    <link rel="stylesheet" href="/style.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
    <meta name="twitter:site" content="@tom_dalling">
    <meta name="twitter:creator" content="@tom_dalling">
    <link rel="alternate" type="application/rss+xml" title="Tom Dalling" href="https://www.tomdalling.com/blog/feed/">
  <link rel="canonical" href="https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">
<meta property="og:title" content="When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString">
<meta property="og:url" content="https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">
<meta name="twitter:card" content="summary">
</head>

  <body>

    <div class="container">

      <div class="row">
        <div class="col-md-12">
          <nav class="navbar navbar-default" role="navigation">
            <div class="container-fluid">
              <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                  <span class="sr-only">Toggle navigation</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">Tom Dalling</a>
              </div>

              <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav">
                  <li><a href="/">Home</a></li>
                  <li><a href="/blog/">Blog</a></li>
                </ul>
              </div>
            </div>
          </nav>
        </div>
      </div>

      <div class="row">

        <main class="col-md-8"><article class="post post-single">

  <header>
    <h1><a href="/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString</a></h1>
    <small class="meta">
      <span class="post-date">08 Mar, 2012</span>
      
      —
      Category: <a class="category" href="/blog/category/coding-tips/">Coding Tips</a>
      —
      Suggest changes <a class="post-github" href="https://github.com/tomdalling/tomdalling.com/tree/main/input/posts/2012-03-08_when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring.markdown">on GitHub</a>
    </small>
    
  </header>

  <div class="post-content">
<p>Let’s start with two exotic strings (console output is in the code comments):</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSString</span><span class="o">*</span> <span class="n">apples</span> <span class="o">=</span> <span class="n">NSGetFrenchWord</span><span class="p">();</span>
<span class="n">NSString</span><span class="o">*</span> <span class="n">oranges</span> <span class="o">=</span><span class="err"> </span><span class="n">NSGetFrenchWord</span><span class="p">();</span>

<span class="n">NSLog</span><span class="p">(</span><span class="s">@"apples == '%@'"</span><span class="p">,</span> <span class="n">apples</span><span class="p">);</span> 
<span class="c1">//apples == 'café'</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"oranges == '%@'"</span><span class="p">,</span> <span class="n">oranges</span><span class="p">);</span> 
<span class="c1">//oranges == 'café'</span>
</code></pre></div></div>

<p>They look identical, but looks can be deceiving.</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSLog</span><span class="p">(</span><span class="s">@"isEqual? %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">isEqual</span><span class="p">:</span><span class="n">oranges</span><span class="p">]</span> <span class="p">?</span> <span class="s">@"YES"</span> <span class="p">:</span> <span class="s">@"NO"</span><span class="p">);</span>
<span class="c1">//isEqual? NO</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"[apples length] == %lu"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">length</span><span class="p">]);</span>
<span class="c1">//[apples length] == 4</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"[oranges length] == %lu"</span><span class="p">,</span> <span class="p">[</span><span class="n">oranges</span> <span class="nf">length</span><span class="p">]);</span>
<span class="c1">//[oranges length] == 5</span>
</code></pre></div></div>

<!--more-->

<p>But if you were to sort them they should be the same, right?</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSLog</span><span class="p">(</span><span class="s">@"NSOrderedSame? %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">compare</span><span class="p">:</span><span class="n">oranges</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span> <span class="p">?</span> <span class="s">@"YES"</span> <span class="p">:</span> <span class="s">@"NO"</span><span class="p">);</span>
<span class="c1">//NSOrderedSame? YES</span>
</code></pre></div></div>

<p>Well at least sorting works. Let’s inspect the strings one character at a time.</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSString</span><span class="o">*</span> <span class="nf">CodePoints</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">NSMutableString</span><span class="o">*</span> <span class="n">codePoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableString</span> <span class="nf">string</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="n">NSUInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">[</span><span class="n">str</span> <span class="nf">length</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
        <span class="kt">long</span> <span class="n">ch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)[</span><span class="n">str</span> <span class="nf">characterAtIndex</span><span class="p">:</span><span class="n">i</span><span class="p">];</span>
        <span class="p">[</span><span class="n">codePoints</span> <span class="nf">appendFormat</span><span class="p">:</span><span class="s">@"%0.4lX "</span><span class="p">,</span> <span class="n">ch</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">codePoints</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">NSLog</span><span class="p">(</span><span class="s">@"apples == %@"</span><span class="p">,</span> <span class="n">CodePoints</span><span class="p">(</span><span class="n">apples</span><span class="p">));</span>
<span class="c1">//apples == 0063 0061 0066 00E9</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"oranges == %@"</span><span class="p">,</span> <span class="n">CodePoints</span><span class="p">(</span><span class="n">oranges</span><span class="p">));</span>
<span class="c1">//oranges == 0063 0061 0066 0065 0301</span>
</code></pre></div></div>

<p>So they are, in fact, different strings.</p>

<p>If you were to look up the above Unicode characters (a.k.a code points) you
would find that:</p>

<ul>
  <li>
<code>0063</code> is ‘c’</li>
  <li>
<code>0061</code> is ‘a’</li>
  <li>
<code>0066</code> is ‘f’</li>
  <li>
<code>0065</code> is ‘e’</li>
  <li>
<code>00E9</code> is ‘é’ (LATIN SMALL LETTER E WITH ACUTE)</li>
  <li>
<code>0301</code> is ‘´’ (COMBINING ACUTE ACCENT)</li>
</ul>

<p>There are at least two ways to represent the glyph ‘é’ in Unicode. One way
is with the single code point <code>00E9</code>. The other is with two code points: an ‘e’
code point (<code>0065</code>) followed by a combining acute accent code point (<code>0301</code>).
Unicode sort of works like ASCII, but not quite.</p>

<p>This is where <a href="http://en.wikipedia.org/wiki/Unicode_normalization">Unicode normalization/equivalence</a> comes into play.
“Normalizing” a Unicode string simply involves taking all the glyphs that look
the same and giving them the same code point sequence. You can “compose” all
the glyphs, which will translate the two code points <code>0065</code> <code>0301</code>
into a single code point <code>00E9</code>. You can also “decompose” all the glyphs, which
will do the opposite. There are <a href="http://unicode.org/reports/tr15/">four types of Unicode normalization</a>, and
<code>NSString</code> provides methods for all of them:</p>

<ul>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/decomposedStringWithCanonicalMapping">decomposedStringWithCanonicalMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/decomposedStringWithCompatibilityMapping">decomposedStringWithCompatibilityMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/precomposedStringWithCanonicalMapping">precomposedStringWithCanonicalMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/precomposedStringWithCompatibilityMapping">precomposedStringWithCompatibilityMapping</a></li>
</ul>

<p>Mad props to Simon for the tip.</p>

</div>

  <footer>
    <div class="alert alert-info subscribe-bait">
      <p>
        <strong>Enjoy this post?</strong>
        <a href="/feed/" class="btn btn-success">Subscribe via RSS</a>
        <a href="https://twitter.com/tom_dalling" class="twitter-follow-button" data-show-count="false" data-size="large">Follow @tom_dalling</a>
      </p>
      <p>
        <strong>Found a mistake?</strong>
        Open a pull request on
        <a class="btn btn-info post-github" href="https://github.com/tomdalling/tomdalling.com/tree/main/input/posts/2012-03-08_when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring.markdown">
          GitHub
        </a>
      </p>
    </div>

    
      <h2>Comments</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript" id="disqus_script">
        var disqus_shortname = "tomdalling";
        var disqus_identifier = "576 http://tomdalling.com/blog/?p=576";
        var disqus_title = "When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString";
        var disqus_url = "https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/";

        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a>
</noscript>
    

  </footer>
</article>
</main>

        <div class="col-md-4 sidebar">

          <div class="panel panel-default">
            <div class="panel-heading">Subscribe</div>
            <ul class="list-group">
              <li class="list-group-item">
                <a href="/blog/feed/">
                  <i class="fa fa-rss"></i> RSS
                </a>
              </li>
              <li class="list-group-item">
                <a href="https://twitter.com/tom_dalling">
                  <i class="fa fa-twitter"></i> Twitter
                </a>
              </li>
            </ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Recent Posts</div>
            <ul class="list-group recent-posts">
              
            <li class="list-group-item">
                <a href="/blog/testing/the-tip-of-the-inputberg/">The Tip Of The Inputberg</a>
              </li>
<li class="list-group-item">
                <a href="/blog/software-processes/better-user-stories/">Better User Stories</a>
              </li>
<li class="list-group-item">
                <a href="/blog/software-design/consistent-hammer-man/">Consistent Hammer Man</a>
              </li>
<li class="list-group-item">
                <a href="/blog/software-design/what-is-the-purpose-of-private/">What Is The Purpose Of Private?</a>
              </li>
<li class="list-group-item">
                <a href="/blog/random-stuff/bleeting-for-fun-and-profit/">Bleeting For Fun And Profit</a>
              </li>
</ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Categories</div>
            <ul class="list-group categories">
              
            <li class="list-group-item">
                <a href="/blog/cocoa/" class="category">Cocoa</a>
                (<span class="post-count">5</span>
                <a class="feed" href="/blog/cocoa/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/coding-styleconventions/" class="category">Coding Style/Conventions</a>
                (<span class="post-count">3</span>
                <a class="feed" href="/blog/coding-styleconventions/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/coding-tips/" class="category">Coding Tips</a>
                (<span class="post-count">4</span>
                <a class="feed" href="/blog/coding-tips/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/random-stuff/" class="category">Miscellaneous</a>
                (<span class="post-count">3</span>
                <a class="feed" href="/blog/random-stuff/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/modern-opengl/" class="category">Modern OpenGL Series</a>
                (<span class="post-count">10</span>
                <a class="feed" href="/blog/modern-opengl/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/ruby/" class="category">Ruby</a>
                (<span class="post-count">2</span>
                <a class="feed" href="/blog/ruby/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/software-design/" class="category">Software Design</a>
                (<span class="post-count">11</span>
                <a class="feed" href="/blog/software-design/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/software-processes/" class="category">Software Processes</a>
                (<span class="post-count">2</span>
                <a class="feed" href="/blog/software-processes/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/testing/" class="category">Testing</a>
                (<span class="post-count">1</span>
                <a class="feed" href="/blog/testing/feed/"><i class="fa fa-rss"></i></a>)
              </li>
<li class="list-group-item">
                <a href="/blog/web/" class="category">Web</a>
                (<span class="post-count">1</span>
                <a class="feed" href="/blog/web/feed/"><i class="fa fa-rss"></i></a>)
              </li>
</ul>
          </div>

          <div class="panel panel-default">
            <div class="panel-heading">Blog Archives</div>
            <ul class="list-group archives">
              
            <li class="list-group-item">
                <a href="/blog/2021/03/" class="month">March 2021</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2020/12/" class="month">December 2020</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2020/11/" class="month">November 2020</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2020/10/" class="month">October 2020</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2020/09/" class="month">September 2020</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2016/02/" class="month">February 2016</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2015/04/" class="month">April 2015</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2015/02/" class="month">February 2015</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2014/11/" class="month">November 2014</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2014/09/" class="month">September 2014</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2014/02/" class="month">February 2014</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2013/04/" class="month">April 2013</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2013/03/" class="month">March 2013</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2013/02/" class="month">February 2013</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2013/01/" class="month">January 2013</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2012/12/" class="month">December 2012</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2012/11/" class="month">November 2012</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2012/07/" class="month">July 2012</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2012/05/" class="month">May 2012</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2012/03/" class="month">March 2012</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2011/12/" class="month">December 2011</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2010/12/" class="month">December 2010</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2010/11/" class="month">November 2010</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2010/05/" class="month">May 2010</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2010/04/" class="month">April 2010</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2010/02/" class="month">February 2010</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/12/" class="month">December 2009</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/11/" class="month">November 2009</a>
                (<span class="post-count">3</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/10/" class="month">October 2009</a>
                (<span class="post-count">2</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/07/" class="month">July 2009</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/06/" class="month">June 2009</a>
                (<span class="post-count">1</span>)
              </li>
<li class="list-group-item">
                <a href="/blog/2009/05/" class="month">May 2009</a>
                (<span class="post-count">1</span>)
              </li>
</ul>
          </div>

        </div>
      </div>

      <footer class="page-footer">
        <p>© 2009 – <span class="current-year">2021</span> Tom Dalling</p>

        <p class="social">
          <a href="https://twitter.com/tom_dalling">
            <i class="fa fa-lg fa-twitter"></i>
          </a>
          <a href="https://github.com/tomdalling">
            <i class="fa fa-lg fa-github"></i>
          </a>
          <a href="https://stackoverflow.com/users/108105/tom-dalling">
            <i class="fa fa-lg fa-stack-overflow"></i>
          </a>
          <a href="mailto:tom%20at%20tomdalling%20com">
            <i class="fa fa-lg fa-envelope"></i>
          </a>
        </p>
      </footer>

      <script src="/bundles/all.js"></script>
      <script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {
            inlineMath: [['$$','$$']],
            displayMath: [['[blockmath]', '[/blockmath]']]
          }
        });
      </script>
      <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    </div>
</body>
</html>
